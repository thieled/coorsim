% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/05_generate_community_labels.R
\name{sample_user_text}
\alias{sample_user_text}
\title{Sample and format user posts for labeling (JSON string)}
\usage{
sample_user_text(
  groups_data,
  user_vars = NULL,
  user_vars_rename = NULL,
  post_vars = NULL,
  post_vars_rename = NULL,
  min_chars = 1,
  max_chars = 1000,
  clean_name = TRUE,
  min_n_posts = 1,
  max_n_posts = 30,
  sampling_ratio_posts = 0.5,
  min_n_users = 1,
  max_n_users = 30,
  sampling_ratio_users = 0.5,
  strat_sample = TRUE,
  seed = 42
)
}
\arguments{
\item{groups_data}{Named list with \code{post_data} and \code{node_list} (both \code{data.table}).
\code{post_data} must contain: \code{post_id}, \code{account_id}, \code{account_name}, \code{content}, \code{community}.}

\item{user_vars}{Character vector of user-level columns to include (besides user name). Default \code{NULL}.}

\item{user_vars_rename}{Named character vector mapping JSON field names to existing user columns.
If \code{NULL}, names in \code{user_vars} are used as JSON names. Default \code{NULL}.}

\item{post_vars}{Character vector of post-level columns to include per post (besides content). Default \code{NULL}.}

\item{post_vars_rename}{Named character vector mapping JSON field names to existing post columns.
If \code{NULL}, names in \code{post_vars} are used as JSON names. Default \code{NULL}.}

\item{min_chars}{Minimum characters required for a cleaned post content to be eligible. Default \code{1}.}

\item{max_chars}{Maximum characters for truncating all cleaned character fields. Use \code{NULL} for no truncation. Default \code{1000}.}

\item{clean_name}{If \code{TRUE}, clean and truncate \code{account_name} before use as user name. Default \code{TRUE}.}

\item{min_n_posts}{Minimum number of posts to sample per user. Default \code{1}.}

\item{max_n_posts}{Maximum number of posts to sample per user. Default \code{30}.}

\item{sampling_ratio_posts}{Proportion of available posts to sample per user before bounding by min/max. Default \code{0.5}.}

\item{min_n_users}{Minimum number of users to sample per community; communities below this are dropped. Default \code{1}.}

\item{max_n_users}{Maximum number of users to sample per community. Default \code{30}.}

\item{sampling_ratio_users}{Proportion of eligible users to sample per community before bounding by min/max. Default \code{0.5}.}

\item{strat_sample}{If \code{TRUE}, sample users within community with probability proportional to post count; if \code{FALSE}, pick most active. Default \code{TRUE}.}

\item{seed}{Integer seed for reproducibility. Default \code{42}.}
}
\value{
The input \code{groups_data} with an added \code{user_labels} \code{data.table}
  (one row per sampled \code{account_id}) with columns:
  \itemize{
    \item \code{account_id}, \code{community}
    \item \code{account_name_clean} (used as user name)
    \item \code{text} (compact JSON-style character string with user fields and a list of posts)
    \item \code{sampled_post_ids} (list column)
    \item \code{approx_tokens} (approximate token count)
    \item \code{user_share_comm} (user's posting share in community)
  }
}
\description{
Samples posts per user and returns a compact JSON-style character string per user.
Character fields are cleaned and truncated to \code{max_chars}. Empty fields are omitted.
}
\details{
All character fields in \code{user_vars} and \code{post_vars} are cleaned and truncated
  before inclusion. Fields that are \code{NA} or empty after cleaning are omitted from the JSON string.
}
